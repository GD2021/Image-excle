# 图片处理与文档生成系统 v2

## 简介 (Introduction)

这是一个现代化的前端Web应用，旨在高效地处理批量图片合并任务，并自动生成包含图片预览的Excel报告。系统通过一个引导式的、用户友好的界面，简化了从选择原始图片到导出最终报告的整个工作流程。

**作者:** ZCHAO v2025.10

---

## 功能特性 (Features)

- **智能图片分组**: 根据文件名（例如 `YYYYMMDD-1.jpg`, `YYYYMMDD-2.jpg`）自动识别并对图片进行分组。
- **批量图片合并**: 将每个有效分组（4张图片）合并成一张 2x2 网格的 JEPG 格式图片。
- **结果实时预览**: 在一个清晰的网格布局中即时显示所有合并后的图片。
- **一键打包下载**: 将所有合并后的图片打包成一个 `.zip` 压缩文件，方便归档和分发。
- **Excel报告生成**: 创建一份专业的 `.xlsx` 报告，其中包含图片编号、处理状态以及嵌入的图片预览。
- **现代化UI/UX**:
    - **引导式流程**: 采用选项卡（Tabs）将操作分为清晰的两步，用户完成第一步后自动解锁第二步。
    - **非阻塞操作**: 所有耗时操作（合并、打包、生成Excel）均在模态框中显示进度，不影响主界面的响应。
    - **响应式设计**: 界面在不同设备尺寸下均有良好表现。

---

## UI设计 (UI Design)

系统采用了具有未来感的“玻璃拟物”（Glassmorphism）设计风格，提供了卓越的视觉体验。

- **主题与背景**: 动态的、由多种色彩（火焰橙、宇宙靛、梦幻紫、落日红）组成的渐变背景，通过CSS动画实现平滑过渡。
- **色彩方案**: 精心挑选的调色板，确保了界面元素的高对比度和可读性。
- **布局与组件**:
    - **选项卡式导航**: 将复杂流程分解为简单的两步：“选择与合并”和“预览与导出”。
    - **卡片式预览**: 合并后的图片以卡片形式展示，每张卡片都包含图片ID和独立的下载按钮。
    - **统一样式**: 所有按钮和交互元素均采用统一的渐变色和圆角设计，增强了视觉一致性。

---

## 项目结构 (Project Structure)

```
.
├── index.html       # 应用主入口和HTML结构
├── index.css        # 全局样式表
├── index.tsx        # 核心业务逻辑 (TypeScript)
├── readme.md        # 项目说明文档
└── metadata.json    # 项目元数据
```

---

## 技术栈 (Tech Stack)

- **前端**: HTML5, CSS3, TypeScript
- **核心库**:
    - **JSZip**: 用于在浏览器端创建和下载 `.zip` 文件。
    - **ExcelJS**: 用于在浏览器端生成结构复杂的 `.xlsx` 文件，并支持图片嵌入。
- **运行环境**: 现代浏览器 (Chrome, Firefox, Safari, Edge等)。无需后端服务或复杂的构建流程，可作为纯静态页面部署。

---

## 工作流程 (Workflow)

1.  **启动应用**: 用户在浏览器中打开 `index.html` 文件。
2.  **步骤一：选择与合并**:
    -   在第一个选项卡中，用户点击“选择本地图片”按钮，并选择所有需要处理的图片文件。
    -   系统根据文件名自动分组，并在状态区显示已识别的分组数量和有效分组（包含4张图片）的数量。
    -   用户点击“开始合并”按钮，系统启动合并流程。
3.  **处理过程**:
    -   一个进度模态框会弹出，实时显示图片合并的进度。
    -   合并完成后，系统会自动切换到第二个选项卡。
4.  **步骤二：预览与导出**:
    -   所有成功合并的图片会以网格形式展示在页面上。
    -   此时，“打包下载 (ZIP)”和“导出为 Excel”按钮变为可用状态。
    -   用户可以点击相应按钮执行操作，整个过程同样会有进度提示。

---

## 实现原理 (Implementation Details)

- **图片合并**:
    -   利用 **HTML5 Canvas API** 实现。
    -   对于每个图片分组，动态创建 `HTMLImageElement` 对象并加载图片。
    -   创建一个尺寸为 `(单图宽度 * 2) x (单图高度 * 2)` 的 `canvas` 元素。
    -   使用 `CanvasRenderingContext2D.drawImage()` 方法将四张图片绘制到 `canvas` 的四个象限中。
    -   最后，调用 `canvas.toBlob('image/jpeg', 0.95)` 将 `canvas` 内容导出为高质量的JPEG格式的Blob对象。

- **ZIP打包**:
    -   初始化一个 `JSZip` 实例。
    -   遍历所有已合并图片的Blob对象，使用 `zip.file(fileName, blob)` 将它们添加到ZIP实例中。
    -   调用 `zip.generateAsync({type:"blob"})` 生成最终的ZIP文件Blob。
    -   通过创建一个临时的 `<a>` 标签并模拟点击来实现文件下载。

- **Excel生成**:
    -   初始化一个 `ExcelJS.Workbook` 实例并创建一个工作表。
    -   设置表头（'图片编号', '图片预览'等）和列宽。
    -   遍历所有已合并的图片，首先通过 `FileReader` 将图片的Blob对象转换为 **Base64** 字符串。
    -   使用 `workbook.addImage()` 将Base64图片数据添加到工作簿中，并获取其ID。
    -   在工作表中添加新行，并调用 `worksheet.addImage()` 将图片ID与特定单元格关联，同时调整行高以完整显示图片。
    -   最后，通过 `workbook.xlsx.writeBuffer()` 生成文件数据，并将其转换为Blob进行下载。
